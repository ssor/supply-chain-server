## 供应链实训协议

### 基础信息

#### 1 编码

供应链的节点以及卡车编码由不同的数字表示，数字分配如下：

- 生产商  1-5

- 分销商  6-10

- 批发商  11-15

- 零售商 16-20

- 卡车  21-25  

#### 2 地图

地图包含了实训的基础信息，由服务端将该基础信息发送给客户端。主要包括以下信息：

1. 节点的最大库存
2. 卡车的最大装载量



### 协议内容

#### 1、获取供应链角色的属性数据(终端 -> 服务端)

##### 使用场景

当终端设备识别出用户放置的角色条码时向服务端发送协议，服务端认为该设备作为某种角色上线

##### 协议内容

```json
{
  "type": 1,    //消息类型
  "roleID": 0   //系统预设的供应链角色ID，用来识别供应链节点的身份
}
```
具体角色编码,，即 roleID， 当前采用硬性编码，具体编码参考基础信息部分



#### 2、下发供应链角色的属性数据(服务端 -> 终端)

##### 使用场景

当服务端接收到设备上线消息后，将发送基础信息给当前具体角色。注意：即使同为批发商，也可能具有不同的库存设计。

##### 协议内容

```json
{
  "type": 2,                    //消息类型
  "gameID": "1627388771",       //实训ID
  "roleID": 0,                  //供应链角色ID，用来标识供应链节点的身份
  "maxInventory": 200,          //仓库的最大库存容量
  "currentInventory": 100,      //当前的库存数量 or 当前的已生产数量
  "gameStartTime": 1627388771   //当前实训的起始时间(Unix时间戳)
}
```


#### 3、下发客户订单数据(服务端 -> 零售商角色的终端)

##### 使用场景

按照设计方案，订单生成后将需求量发给零售商。如果零售商多于一个，随机选择一个零售商。

客户端接收到该信息后，需要展现相应的动画，不追求一比一。

MVP版本默认只有一种商品类型，不考虑由多种商品类型所组成的客户订单的情况，所以客户订单数据中只明确定义一种默认商品的购买数量

##### 协议内容

```json
{
  "type": 3,                     //消息类型
  "gameID": "1627388771",        //实训ID
  "roleID": 0,                   //供应链角色ID，此处的ID一定是一个零售商类型的角色ID，因为只有零售商能接收客户订单
  "purchaseCnt": 1,              //购买数量，MVP版本这个数值设定为1
  "gameStartTime": 1627388771    //当前实训的起始时间(Unix时间戳)
}
```


#### 4、设置货运卡车的行驶目的地(终端 -> 服务端)

##### 使用场景

当用户将货运卡车的条码放置在一个新的位置，这个新的位置一般是另一个终端。

此时终端向服务端发送此消息，相当于将当前供应链角色的仓库位置设置为货运卡车的行驶目的地，服务端应该计算该卡车距离目的地的距离，并模拟其运行位置

##### 协议内容

```json
{
  "type": 4,                    //消息类型
  "gameID": "1627388771",       //实训ID
  "roleID": 0,                 //供应链角色ID，用来标识供应链节点的身份
  "truckID": 20                //货运卡车ID，用来标识货运卡车的身份
}
```


#### 5、下发货运卡车的运载与相对位置数据(服务端 -> 终端)

##### 使用场景

当货运卡车处于正在行驶的状态下，服务端每间隔一段时间向终端发送此消息，直到货运卡车抵达目的地为止

##### 协议内容

```json
{
  "type": 5,                     //消息类型
  "gameID": "1627388771",        //实训ID
  "roleID": 0,                   //供应链角色ID，用来标识供应链节点的身份
  "truckID": 20,                 //货运卡车ID，用来标识货运卡车的身份
  "tMaxQuantity": 40,            //货运卡车的最大装载容量
  "tQuantity": 15,               //货运卡车的当前已装载数量
  "remainingDistance": 26000,    //货运卡车距离当前供应链节点的剩余里程，单位米
  "gameStartTime": 1627388771    //当前实训的起始时间(Unix时间戳)
}
```


#### 6、更新供应链节点的库存数据之出库(终端 -> 服务端)

##### 使用场景

当节点因为出库或者入库，库存确定发生变动时。

操作方面，一般是用户将货运卡车的条码从入库识别区域或者出库识别区域拿走之时

##### 协议内容

```json
{
  "type": 6,                    //消息类型
  "gameID": "1627388771",       //实训ID
  "roleID": 0,                  //供应链角色ID，用来标识供应链节点的身份
  "currentInventory": 100,      //当前的库存数量 or 当前的已生产数量
  "truckID": 20,                //货运卡车ID，用来标识货运卡车的身份
  "tQuantity": 10               //货运卡车的当前已装载数量
}
```


#### 7、更新供应链节点的库存数据之二(零售商角色终端 -> 服务端)

##### 使用场景

当零售商节点将商品出售时

##### 协议内容

```json
{
  "type": 7,                 //消息类型
  "gameID": "1627388771",    //实训ID
  "roleID": 0,               //供应链角色ID，此处的ID是一个零售商类型的角色ID，因为只有零售商能接收客户订单
  "currentInventory": 20     //供应链节点的当前库存
}
```


#### 8、下发实验重置通知(服务端 -> 终端)

##### 使用场景

当管理员在供应链实训系统的管理页面中执行了“重置实验”的操作后

##### 协议内容

```json
{
  "type": 8,                    //消息类型
  "gameID": "1627388771",       //实训ID
  "roleID": 0,                 //暂时不用
  "gameStartTime": 1627388771   //当前实训的起始时间(Unix时间戳)
}
```
